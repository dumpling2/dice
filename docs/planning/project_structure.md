# Discord ダイスボット プロジェクト構造

このドキュメントでは、ダイスボットの理想的なプロジェクト構造について説明します。

## 基本原則

このプロジェクト構造は以下の原則に基づいています：

1. **単一責任の原則** - 各モジュールは明確に定義された責任範囲を持つ
2. **関心の分離** - 異なる機能を別々のモジュールに分割する
3. **拡張性** - 新機能を追加しやすい構造を維持する
4. **テスト容易性** - 各モジュールを個別にテストできるようにする

## ディレクトリ構造

```
dice/
├── src/                 # ソースコード
│   ├── dice/            # ダイスロールの中核ロジック
│   │   ├── parser.py    # ダイス表記の解析
│   │   ├── roller.py    # ダイスロール実行
│   │   └── renderer.py  # 結果表示
│   ├── commands/        # コマンド処理
│   │   ├── roll.py      # ロールコマンド
│   │   └── history.py   # 履歴コマンド
│   ├── utils/           # ユーティリティ
│   │   └── logger.py    # ロギング
│   └── views/           # UI要素
│       └── dice_view.py # ダイスUI
├── config/              # 設定
│   └── settings.py      # 設定管理
├── tests/               # テストコード
├── docs/                # ドキュメント
└── main.py              # ランチャー
```

## モジュールの責任

### src/dice/

ダイスロールに関する中核ロジックを含むモジュール。

- **parser.py** - ダイス表記（例: "2d6+3"）をパースし、構造化されたデータに変換
- **roller.py** - 実際のダイスロールを実行し、結果を生成
- **renderer.py** - ロール結果をDiscord Embedsで表示するための処理

### src/commands/

ユーザーコマンドの処理を担当するモジュール。

- **roll.py** - `!roll` コマンドの処理
- **history.py** - `!history` コマンドの処理

### src/utils/

共通ユーティリティ機能を提供するモジュール。

- **logger.py** - ロギング機能

### src/views/

Discord UIコンポーネント（ボタン、セレクトメニューなど）を管理するモジュール。

- **dice_view.py** - ダイスロール用のカスタムビュー（インタラクティブボタンなど）

### config/

アプリケーション設定を管理するモジュール。

- **settings.py** - 設定値の管理（環境変数、定数など）

### tests/

テストコードを格納するディレクトリ。

- モジュールごとにユニットテストを配置

### docs/

プロジェクトのドキュメントを格納するディレクトリ。

### main.py

アプリケーションのエントリーポイント。ボットの初期化と起動を担当。

## コーディングガイドライン

- ファイルサイズを300行以下に保つ
- 関数は50行以下に保ち、単一の責任を持たせる
- すべての公開API（クラス、関数）にはdocstringを記述する
- 型ヒント（Type Hints）を積極的に使用する
- テストコードで高いカバレッジを維持する

## 依存関係

モジュール間の依存関係を以下のように設計します：

```
main.py
  ↓
  ├─ config/settings.py
  ↓
src/bot.py
  ↓
  ├─ src/commands/roll.py ─────┐
  │   ↓                       │
  │   ├─ src/dice/parser.py   │
  │   ├─ src/dice/roller.py   │
  │   └─ src/dice/renderer.py │
  │   └─ src/views/dice_view.py
  │                           │
  └─ src/commands/history.py ─┘
      ↓
      └─ src/utils/logger.py
```

この構造により、モジュール間の依存関係が明確になり、テストとメンテナンスが容易になります。 